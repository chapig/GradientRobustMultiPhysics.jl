<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>2D Poisson Problem + Error Estimator + H2 Error · GradientRobustMultiPhysics.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">GradientRobustMultiPhysics.jl</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../fems/">Implemented Finite Elements</a></li><li><a class="tocitem" href="../../fespace/">FE Spaces and Arrays</a></li><li><a class="tocitem" href="../../functionoperators/">Function Operators</a></li><li><a class="tocitem" href="../../pdedescription/">PDE Description</a></li><li><a class="tocitem" href="../../pdeprototypes/">PDE Prototypes</a></li><li><a class="tocitem" href="../../pdesolvers/">PDE Solvers</a></li><li><a class="tocitem" href="../../abstractactions/">Abstract Actions</a></li><li><a class="tocitem" href="../../assembly_details/">Assembly Details</a></li><li><a class="tocitem" href="../../meshing/">Meshing</a></li><li><a class="tocitem" href="../../quadrature/">Quadrature</a></li><li><a class="tocitem" href="../../viewers/">Export/Viewers</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../../examples_intro/">How to run the examples</a></li><li><a class="tocitem" href="../doc_1d_bestapprox/">1D L2-Bestapproximation</a></li><li class="is-active"><a class="tocitem" href>2D Poisson Problem + Error Estimator + H2 Error</a></li><li><a class="tocitem" href="../doc_2d_bestapprox_curlpreserve/">2D Curl-Preserving L2-Bestapproximation</a></li><li><a class="tocitem" href="../doc_2d_bestapprox_divpreserve/">2D Divergence-Preserving L2-Bestapproximation</a></li><li><a class="tocitem" href="../doc_2d_commutinginterpolators/">Commuting Interpolators (2D)</a></li><li><a class="tocitem" href="../doc_2d_compressiblestokes/">2D Compressible Stokes</a></li><li><a class="tocitem" href="../doc_2d_convectiondiffusion/">2D Convection-Diffusion-Problem</a></li><li><a class="tocitem" href="../doc_2d_cookmembrane/">2D Linear Elasticity</a></li><li><a class="tocitem" href="../doc_2d_flowtransport/">2D Flow + Transport</a></li><li><a class="tocitem" href="../doc_2d_hagenpoiseuille/">2D Hagen-Poiseuille (Navier–Stokes)</a></li><li><a class="tocitem" href="../doc_2d_jumpestimator/">2D Jump-Estimator</a></li><li><a class="tocitem" href="../doc_2d_liddrivencavity_anderson/">2D Lid-driven cavity (Anderson-Iteration)</a></li><li><a class="tocitem" href="../doc_2d_liddrivencavity_autonewton/">2D Lid-driven cavity (AD-Newton)</a></li><li><a class="tocitem" href="../doc_2d_stokes_probust/">2D Pressure-robustness</a></li><li><a class="tocitem" href="../doc_2d_transientstokes/">2D Transient Stokes-Problem</a></li><li><a class="tocitem" href="../doc_3d_commutinginterpolators/">Commuting Interpolators (3D)</a></li><li><a class="tocitem" href="../doc_3d_elasticity/">3D Linear Elasticity</a></li><li><a class="tocitem" href="../doc_3d_poisson/">3D Poisson-Problem</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>2D Poisson Problem + Error Estimator + H2 Error</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>2D Poisson Problem + Error Estimator + H2 Error</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/chmerdon/GradientRobustMultiPhysics.jl/blob/master/docs/src/examples/doc_2d_Poisson_estimator.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="D-Poisson-Problem-Error-Estimator-H2-Error"><a class="docs-heading-anchor" href="#D-Poisson-Problem-Error-Estimator-H2-Error">2D Poisson Problem + Error Estimator + H2 Error</a><a id="D-Poisson-Problem-Error-Estimator-H2-Error-1"></a><a class="docs-heading-anchor-permalink" href="#D-Poisson-Problem-Error-Estimator-H2-Error" title="Permalink"></a></h1><p>(<a href="https://github.com/chmerdon/GradientRobustMultiPhysics.jl/raw/master/examples/doc_2d_Poisson_estimator.jl">source code</a>)</p><p>This example computes the standard-residual error estimator for the <span>$H^1$</span> error of some (vector-valued) <span>$H^1$</span>-conforming approximation <span>$\mathbf{u}_h$</span> to the solution <span>$\mathbf{u}$</span> of some vector Poisson problem <span>$-\Delta \mathbf{u} = \mathbf{f}$</span>, i.e.</p><div>\[\eta^2(\mathbf{u}_h) := \sum_{T \in \mathcal{T}} \lvert T \rvert \| \mathbf{f} + \Delta \mathbf{u}_h \|^2_{L^2(T)}
+ \sum_{F \in \mathcal{F}} \lvert F \rvert \| [[D\mathbf{u}_h \mathbf{n}]] \|^2_{L^2(F)}\]</div><p>This example script showcases the evaluation of 2nd order derivatives, i.e. the Laplacian in the volume term of the error estimator and the full Hessian for the computation of the error in the H2 semi-norm.</p><p>(In future updates adaptive mesh refinement may be possible based on these error indicators.)</p><pre><code class="language-julia">module Example_ErrorEstimatorPoisson

using GradientRobustMultiPhysics
using Printf

# exact solution u for the Poisson problem
function exact_function!(result,x)
    result[1] = x[1]^3
    result[2] = x[1]*x[2]
end
# ... and its derivatives
function exact_function_gradient!(result,x)
    result[1] = 3*x[1]^2 # = du1 / dx
    result[2] = 0        # = du1 / dy
    result[3] = x[2]     # = du2 / dx
    result[4] = x[1]     # = du2 / dy
end
# ... and its 2nd order derivatives
function exact_function_hessian!(result,x)
    result[1] = 6*x[1]  # = d^2 u1 / dx^2
    result[2] = 0       # = d^2 u1 / dxdy
    result[3] = 0       # = d^2 u1 / dydx
    result[4] = 0       # = d^2 u1 / dy^2
    result[5] = 0       # = d^2 u2 / dx^2
    result[6] = 1       # = d^2 u2 / dxdy
    result[7] = 1       # = d^2 u2 / dydx
    result[8] = 0       # = d^2 u2 / dy^2
end
# right-hand side for the Poisson problem, i.e. f = - \Delta u
function rhs!(result,x)
    result[1] = -6*x[1]
    result[2] = 0
end

# everything is wrapped in a main function
function main(; verbosity = 1, nlevels = 6)

    # initial grid
    xgrid = simplexgrid([0.0,1.0],[0.0,1.0])

    # choose some finite element
    FEType = H1P2{2,2}

    # setup a bestapproximation problem via a predefined prototype
    Problem = PoissonProblem(2; ncomponents = 2, diffusion = 1.0)
    add_boundarydata!(Problem, 1, [1,2,3,4], BestapproxDirichletBoundary; data = exact_function!, bonus_quadorder = 3)
    add_rhsdata!(Problem, 1,  RhsOperator(Identity, [0], rhs!, 2, 2; bonus_quadorder = 1))

    # setup exact error evaluations
    L2ErrorEvaluator = L2ErrorIntegrator(exact_function!, Identity, 2, 2; bonus_quadorder = 4)
    H1ErrorEvaluator = L2ErrorIntegrator(exact_function_gradient!, Gradient, 2, 4; bonus_quadorder = 3)
    H2ErrorEvaluator = L2ErrorIntegrator(exact_function_hessian!, Hessian, 2, 8; bonus_quadorder = 2)

    # refinement loop (only uniform for now)
    NDofs = zeros(Int, nlevels)
    Results = zeros(Float64, nlevels, 4)
    for level = 1 : nlevels

        # uniform mesh refinement
        xgrid = uniform_refine(xgrid)

        # create a solution vector and solve the problem
        FES = FESpace{FEType}(xgrid)
        Solution = FEVector{Float64}(&quot;Discrete Solution&quot;,FES)
        solve!(Solution, Problem; verbosity = verbosity)
        NDofs[level] = length(Solution[1])

        # error estimator jump term
        xFaceVolumes = xgrid[FaceVolumes]
        function L2jump_integrand(result, input, item)
            for j = 1 : length(input)
                result[j] = input[j]^2 * xFaceVolumes[j]
            end
            return nothing
        end
        jumpIntegrator = ItemIntegrator{Float64,ON_IFACES}(GradientDisc{Jump},ItemWiseFunctionAction(L2jump_integrand, [4,4]; bonus_quadorder = 2), [0])

        # error estimator volume term : h * ||f + Laplace(u_h)||
        xCellVolumes = xgrid[CellVolumes]
        function L2vol_integrand(result, input, x, item)
            rhs!(result,x)
            for j = 1 : length(input)
                input[j] += result[j]
                result[j] = input[j]^2 * xCellVolumes[j]
            end
            return nothing
        end
        jumpIntegrator = ItemIntegrator{Float64,ON_CELLS}(Laplacian,ItemWiseXFunctionAction(L2vol_integrand, [2,2], 2; bonus_quadorder = 2), [0])

        # complete error estimator
        vol_error = sqrt(sum(evaluate(jumpIntegrator,[Solution[1]])))
        jump_error = sqrt(sum(evaluate(jumpIntegrator,[Solution[1]])))

        # calculate L2 error, H1 error, estimator and H2 error Results and write to results
        Results[level,1] = sqrt(evaluate(L2ErrorEvaluator,[Solution[1]]))
        Results[level,2] = sqrt(evaluate(H1ErrorEvaluator,[Solution[1]]))
        Results[level,3] = sqrt(jump_error^2 + vol_error^2)
        Results[level,4] = sqrt(evaluate(H2ErrorEvaluator,[Solution[1]]))

    end

    # print results
    @printf(&quot;\n  NDOFS  |   L2ERROR      order   |   H1ERROR      order   | H1-ESTIMATOR   order   |   H2ERROR      order   &quot;)
    @printf(&quot;\n=========|========================|========================|========================|=========================\n&quot;)

    order = 0
    for j=1:nlevels
        @printf(&quot;  %6d |&quot;,NDofs[j]);
        for k = 1 : 4
            if j &gt; 1
                order = log(Results[j-1,k]/Results[j,k]) / (log(NDofs[j]/NDofs[j-1])/2)
            end
            @printf(&quot; %.5e &quot;,Results[j,k])
            @printf(&quot;   %.3f   |&quot;,order)
        end
        @printf(&quot;\n&quot;)
    end

end

end</code></pre><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../doc_1d_bestapprox/">« 1D L2-Bestapproximation</a><a class="docs-footer-nextpage" href="../doc_2d_bestapprox_curlpreserve/">2D Curl-Preserving L2-Bestapproximation »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Tuesday 3 November 2020 16:07">Tuesday 3 November 2020</span>. Using Julia version 1.5.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
